<UserControl x:Class="Cats.Telescope.VsExtension.Views.MainWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:e="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:bindTreeViewExpand="clr-namespace:Cats.Telescope.VsExtension.Core.Behaviors"
             xmlns:converters="clr-namespace:Cats.Telescope.VsExtension.Core.Converters"
             xmlns:viewmodels="clr-namespace:Cats.Telescope.VsExtension.ViewModels"
             xmlns:toolkit="clr-namespace:Community.VisualStudio.Toolkit;assembly=Community.VisualStudio.Toolkit"
             xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
             d:DataContext="{d:DesignInstance Type=viewmodels:MainWindowViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="600"
             Name="MyToolWindow"
             toolkit:Themes.UseVsTheme="True">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:NullToCollapsedConverter x:Key="NullToCollapsedConverter"/>

        <Style TargetType="TabControl" BasedOn="{StaticResource {x:Static vsshell:VsResourceKeys.ThemedDialogTabControlNavigationStyleKey}}"/>
        <Style TargetType="TabItem" BasedOn="{StaticResource {x:Static vsshell:VsResourceKeys.ThemedDialogTabItemNavigationStyleKey}}"/>

    </UserControl.Resources>

    <Grid>
        <Grid Margin="10" 
              Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=reverse}">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Padding="2" 
                         Margin="0, 5"/>

                <StackPanel Orientation="Horizontal"
                            Grid.Column="1"
                            Margin="5">
                    <Button Content="Search"/>
                    <Button Content="Filter"
                            Margin="5,0,0,0"/>
                </StackPanel>
            </Grid>

            <Grid Grid.Row="1"
                  Margin="5">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MinWidth="150"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*" MinWidth="150"/>
                </Grid.ColumnDefinitions>

                <TreeView Grid.Column="0"
                          Margin="0,5,10,0"
                          Padding="5, 10"
                          ItemsSource="{Binding ResourceNodes}">
                    <TreeView.Resources>
                        <Style TargetType="TreeViewItem">
                            <Setter Property="bindTreeViewExpand:Behaviours.ExpandingBehaviour" Value="{Binding ExpandCommand}"/>
                        </Style>
                    </TreeView.Resources>
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="{x:Type TreeViewItem}">
                            <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsVisible}" Value="False">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TreeView.ItemContainerStyle>
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Path=ResourceNodes}">
                            <TextBlock Text="{Binding Id}" />
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>

                    <e:Interaction.Behaviors>
                        <bindTreeViewExpand:BindableSelectedItemBehavior SelectedItem="{Binding SelectedNode, Mode=TwoWay}" />
                    </e:Interaction.Behaviors>
                </TreeView>

                <GridSplitter Grid.Column="1"
                              ShowsPreview="False" 
                              Width="5"
                              Margin="0, -10"
                              Background="{DynamicResource {x:Static vsshell:VsBrushes.AccentBorderKey}}"
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Stretch" />

                <Grid Grid.Column="2"
                      Margin="10, 5">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal"
                                Margin="5">
                        <TextBlock Text="{Binding SelectedNode.Type, StringFormat='[{0}]'}"
                                   FontSize="18"/>
                        <TextBlock Text="{Binding SelectedNode.Id}"
                                   FontSize="18"
                                   Margin="2,0,0,0"/>
                    </StackPanel>
                    
                    <TabControl FontSize="12"
                                Grid.Row="1"
                                Margin="5">
                        <TabItem Header="Configuration JSON">
                            <ScrollViewer>
                                <TextBlock Text="{Binding SelectedNode.Data, FallbackValue={x:Null}}"
                                           Margin="5"
                                           VerticalAlignment="Top"
                                           HorizontalAlignment="Left"/>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="Tags">
                            <ListView ItemsSource="{Binding SelectedNode.Tags}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock Text="{Binding Key}"
                                                       FontSize="12"
                                                       FontWeight="Bold"/>

                                            <TextBlock Text="{Binding Value, StringFormat=' - {0}'}"
                                                       FontSize="12"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Grid>
        </Grid>

        <TextBlock Text="{Binding BusyText}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}"/>
    </Grid>
</UserControl>
